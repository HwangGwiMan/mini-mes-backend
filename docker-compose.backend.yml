# 백엔드 전용 (DB는 별도 실행 필요) - 로컬: 기본값 / 운영: --env-file .env.prod
# 1) DB 먼저: docker compose -f docker-compose.db.yml up -d
# 2) 백엔드: docker compose -f docker-compose.backend.yml up -d (또는 --build -d)
# 운영 시 둘 다 --env-file .env.prod 지정
services:
  backend:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: mini-mes-backend
    environment:
      SPRING_PROFILES_ACTIVE: ${SPRING_PROFILES_ACTIVE:-local}
      SPRING_DATASOURCE_URL: jdbc:postgresql://mini-mes-postgres:5432/${POSTGRES_DB:-mini_mes}
      SPRING_DATASOURCE_USERNAME: ${POSTGRES_USER:-postgres}
      SPRING_DATASOURCE_PASSWORD: ${POSTGRES_PASSWORD:-postgres}
      DB_URL: jdbc:postgresql://mini-mes-postgres:5432/${POSTGRES_DB:-mini_mes}
      DB_USERNAME: ${POSTGRES_USER:-postgres}
      DB_PASSWORD: ${POSTGRES_PASSWORD:-postgres}
    ports:
      - "${BACKEND_PORT:-8080}:8080"
    networks:
      - mini-mes-network
    restart: ${RESTART_POLICY:-no}

networks:
  mini-mes-network:
    external: true
